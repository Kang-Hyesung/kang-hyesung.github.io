---
title: "[1] Routing 개요"
date: 2025-07-22 22:20 +0900
author: hyesung
---
ASP.NET Core에서 **라우팅(Routing)**은 들어오는 HTTP 요청을 분석하여 적절한 **엔드포인트(Endpoint)**로 연결하는 핵심적인 과정이다. 이 글에서는 라우팅의 기본 개념부터 동작 원리까지 자세히 알아보자.

---

### 라우팅 (Routing)이란?

**라우팅**은 클라이언트로부터 들어온 HTTP 요청의 URL과 메서드(GET, POST 등)를 확인하고, 미리 정의된 엔드포인트 목록과 비교하여 일치하는 것을 찾아 실행하는 메커니즘이다.
예를 들어, 다음과 같이 URL과 엔드포인트가 매핑되어 있다고 가정할 수 있다.

> `/home` URL 요청 → HomePage 엔드포인트 실행
> `/about` URL 요청 → AboutPage 엔드포인트 실행

이처럼 라우팅은 특정 URL 요청에 맞는 적절한 비즈니스 로직이나 페이지를 제공하기 위해 반드시 필요하다. 여기서 **엔드포인트**는 요청을 처리하는 최종 목적지로, 실제로는 하나의 **미들웨어(Middleware)**다.

---

### UseRouting과 UseEndpoints

ASP.NET Core는 라우팅을 설정하기 위해 `UseRouting`과 `UseEndpoints`라는 두 가지 미들웨어를 사용한다. 이 두 미들웨어는 반드시 정해진 순서대로 호출되어야 한다. **`UseRouting`을 먼저 호출한 후 `UseEndpoints`를 호출해야 한다.**

#### 1. app.UseRouting()

`UseRouting` 미들웨어는 애플리케이션에서 라우팅 기능을 활성화하는 역할을 한다. 이 미들웨어는 들어오는 요청의 URL 경로와 HTTP 메서드를 기반으로 어떤 엔드포인트를 실행할지 결정하고 **선택**한다.
> **중요**: `UseRouting`은 엔드포인트를 선택할 뿐, 실제로 실행하지는 않는다.

#### 2. app.UseEndpoints()

`UseEndpoints` 미들웨어는 `UseRouting`에 의해 선택된 엔드포인트를 실제로 **실행**하는 역할을 한다. 개발자는 이 미들웨어의 `endpoints` 매개변수를 통해 실제 URL과 실행될 코드를 매핑하는 작업을 수행한다. 이러한 매핑은 `Map*` (예: `MapGet`, `MapPost`, `MapControllers` 등) 확장 메서드를 사용하여 정의된다.

---

### 왜 UseRouting과 UseEndpoints는 분리되어 있을까?

두 기능이 분리된 이유는 요청 처리 **파이프라인(Pipeline)**의 유연성 때문이다. `UseRouting`으로 목적지를 먼저 결정한 뒤, `UseEndpoints`로 실제 실행하기 전 그 사이에 다른 미들웨어를 추가할 수 있다. 가장 대표적인 예가 **인증 및 권한 부여**다.

```csharp
// 1. [경로 결정] 먼저 이 요청이 어느 엔드포인트로 가야 하는지 결정
app.UseRouting();

// 2. [중간 처리] 목적지에 가기 전, 신원 및 권한 확인
app.UseAuthentication(); // 사용자가 로그인했는지 확인
app.UseAuthorization();  // 사용자에게 접근 권한이 있는지 확인

// 3. [경로 실행] 모든 검사를 통과했다면, 원래 목적지였던 엔드포인트를 실행
app.UseEndpoints(endpoints =>
{
    // endpoints.MapGet("/admin", () => "관리자 페이지입니다.").RequireAuthorization();
});
```

이처럼 역할을 분리함으로써, "이 목적지는 관리자만 접근 가능해"와 같은 정교한 규칙을 파이프라인 중간에 손쉽게 추가할 수 있다.

---

### 코드 예시: Program.cs

다음은 `Program.cs` 파일에 라우팅을 설정하는 기본적인 코드 구조다.

```csharp
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

// 1. 라우팅 기능을 활성화하고, 요청에 맞는 엔드포인트를 '선택'한다.
app.UseRouting();

// 2. 선택된 엔드포인트를 '실행'한다.
// 람다 표현식 내에서 실제 엔드포인트를 정의하고 매핑한다.
app.UseEndpoints(endpoints =>
{
    // 여기에 Map* 메서드를 사용하여 엔드포인트를 추가한다.
    // 예: endpoints.MapGet("/", () => "Hello World!");
});

app.Run();
```

---

### 심화: 설정과 실행의 차이 (브레이크포인트의 비밀)

`Program.cs`의 코드를 볼 때 가장 많이 헷갈리는 부분은 '언제 실행되는가' 이다. 이것은 **'설정'**과 **'실행'** 두 단계로 나누어 이해해야 한다.

- **설정 (앱 시작 시 단 1회)**: `Program.cs`의 `app.UseRouting();` 같은 코드는 애플리케이션이 처음 시작될 때 단 한 번만 실행된다. 이 단계는 앞으로 요청이 들어왔을 때 어떤 순서로 처리할지에 대한 규칙(파이프라인)을 만드는 과정이다. 따라서 `app.UseRouting();` 줄에 브레이크포인트를 걸면 앱 시작 시 한 번만 멈춘다.
- **실행 (모든 요청마다)**: 위에서 만들어진 규칙(파이프라인)은 모든 HTTP 요청이 들어올 때마다 실행된다. 요청이 들어오면 파이프라인의 첫 번째 미들웨어부터 순서대로 통과하며 처리된다. 요청마다 이 과정이 일어나는 것을 확인하려면, `endpoints.MapGet("/", () => { ... })`와 같이 실제 실행되는 코드 블록 안에 브레이크포인트를 걸어야 한다.
    

---

### 요약

- **라우팅(Routing)**: 요청 URL을 분석하여 적절한 엔드포인트로 연결하는 과정이다.
- **app.UseRouting()**: 실행할 엔드포인트를 **선택**하는 역할을 한다.
- **app.UseEndpoints()**: 선택된 엔드포인트를 **실행**하고, 실제 URL과 코드를 매핑한다.
- **분리 이유**: 두 미들웨어 사이에 인증/권한 부여 같은 추가적인 로직을 삽입하여 파이프라인을 유연하게 만들기 위함이다.
- **동작 방식**: `Program.cs`의 코드는 앱 시작 시 한 번만 실행되어 규칙을 **설정**하고, 이 설정된 규칙(파이프라인)은 모든 요청마다 **실행**된다.