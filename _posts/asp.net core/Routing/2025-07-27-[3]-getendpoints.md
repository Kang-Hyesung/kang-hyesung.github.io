---
title: "[3] GetEndpoints"
date: 2025-07-27 22:13 +0900
author: hyesung
---
ASP.NET Core μ• ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ”μ²­μ΄ μ²λ¦¬λλ” λ°©μ‹μ μ¤‘μ‹¬μ—λ” **λ―Έλ“¤μ›¨μ–΄ νμ΄ν”„λΌμΈ(Middleware Pipeline)**μ΄ μκ³ , λΌμ°ν…μ€ μ΄ νμ΄ν”„λΌμΈμ ν•µμ‹¬μ μΈ λ¶€λ¶„μ΄λ‹¤. μ΄ κΈ€μ—μ„λ”  `UseRouting()`κ³Ό `UseEndpoints()`κ°€ κ°κ° μ–΄λ–¤ μ—­ν• μ„ ν•λ©°, μ΄λ“¤ μ‚¬μ΄μ—μ„ `HttpContext.GetEndpoint()`λ¥Ό ν†µν•΄ μ–΄λ–»κ² μ—”λ“ν¬μΈνΈ(Endpoint) μ •λ³΄λ¥Ό ν™•μΈν•λ”μ§€ μ•μ•„λ³Έλ‹¤.

### π¤” ν•µμ‹¬ κ°λ…: μ„ νƒκ³Ό μ‹¤ν–‰μ λ¶„λ¦¬

ASP.NET Core λΌμ°ν…μ κ°€μ¥ μ¤‘μ”ν• νΉμ§•μ€ **μ—”λ“ν¬μΈνΈλ¥Ό μ„ νƒν•λ” λ‹¨κ³„**μ™€ **μ„ νƒλ μ—”λ“ν¬μΈνΈλ¥Ό μ‹¤ν–‰ν•λ” λ‹¨κ³„**κ°€ λ¶„λ¦¬λμ–΄ μλ‹¤λ” μ μ΄λ‹¤.

1. **`app.UseRouting()` - μ—”λ“ν¬μΈνΈ μ„ νƒμ**
    
    - μ΄ λ―Έλ“¤μ›¨μ–΄λ” λ“¤μ–΄μ¤λ” μ”μ²­(Request)μ URL, HTTP λ©”μ„λ“ λ“±μ„ λ¶„μ„ν•λ‹¤.
    - κ·Έλ¦¬κ³  μ½”λ“μ— μ •μλ μ—¬λ¬ μ—”λ“ν¬μΈνΈ(`MapGet`, `MapPost` λ“±) μ¤‘μ—μ„ μ–΄λ–¤ κ²ƒμ„ μ‹¤ν–‰ν•΄μ•Ό ν• μ§€ **κ²°μ •ν•κ³  μ„ νƒ**ν•λ‹¤.
    - **μ¤‘μ”:** μ΄ λ‹¨κ³„μ—μ„λ” μ½”λ“λ¥Ό _μ‹¤ν–‰ν•μ§€ μ•κ³ _ μ–΄λ–¤ μ½”λ“λ¥Ό μ‹¤ν–‰ν• μ§€λ§ κ²°μ •ν•μ—¬ `HttpContext`μ— μ €μ¥ν•λ‹¤. λ§μΉ μ‹λ‹Ήμ—μ„ λ©”λ‰΄νμ„ λ³΄κ³  μ£Όλ¬Έν•  μμ‹μ„ κ³ λ¥΄λ” κ²ƒκ³Ό κ°™λ‹¤.
        
2. **`app.UseEndpoints()` - μ—”λ“ν¬μΈνΈ μ‹¤ν–‰μ**
    
    - `UseRouting()`μ— μν•΄ μ„ νƒλ μ—”λ“ν¬μΈνΈμ μ½”λ“λ¥Ό **μ‹¤μ λ΅ μ‹¤ν–‰**ν•λ” μ—­ν• μ„ ν•λ‹¤.
    - μ„ νƒλ μ—”λ“ν¬μΈνΈκ°€ μ—†λ‹¤λ©΄ μ•„λ¬΄κ²ƒλ„ μ‹¤ν–‰ν•μ§€ μ•λ”λ‹¤. μ‹λ‹Ήμ—μ„ μ£Όλ¬Έν• μμ‹μ„ μ”λ¦¬μ‚¬κ°€ μ§μ ‘ λ§λ“¤μ–΄μ£Όλ” κ³Όμ •μ— λΉ„μ ν•  μ μλ‹¤.

μ΄ λ‘ κ³Όμ • μ‚¬μ΄μ—μ„, μ¦‰ "μμ‹μ„ κ³ λ¥Έ μ§ν›„, μ”λ¦¬κ°€ μ‹μ‘λκΈ° μ „"μ— μ–΄λ–¤ μμ‹μ΄ μ„ νƒλμ—λ”μ§€ μ—Ώλ³΄λ” κ²ƒμ€ `HttpContext.GetEndpoint()` λ©”μ„λ“λ¥Ό μ‚¬μ©ν•λ©΄ κ°€λ¥ν•λ‹¤.

---

### π’» μ½”λ“λ΅ ν™•μΈ

μ•„λ μ½”λ“λ” `UseRouting()` μ „κ³Ό ν›„μ— κ°κ° λ―Έλ“¤μ›¨μ–΄λ¥Ό λ°°μΉν•μ—¬ `GetEndpoint()` λ©”μ„λ“μ λ°ν™ κ°’μ΄ μ–΄λ–»κ² λ‹¬λΌμ§€λ”μ§€ λ³΄μ—¬μ£Όλ” μμ λ‹¤.

```csharp
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

// --- 1. 'UseRouting' νΈμ¶ μ „ λ―Έλ“¤μ›¨μ–΄ ---
// μ΄ μ‹μ μ—μ„λ” μ•„μ§ μ—”λ“ν¬μΈνΈκ°€ μ„ νƒλμ§€ μ•μ•λ‹¤.
app.Use(async (context, next) =>
{
    // GetEndpoint()λ¥Ό νΈμ¶ν•΄λ„ μ•„μ§ λΌμ°ν…μ΄ κ²°μ •λμ§€ μ•μ•μΌλ―€λ΅ nullμ„ λ°ν™ν•λ‹¤.
    Microsoft.AspNetCore.Http.Endpoint? endPoint = context.GetEndpoint();

    // endpointκ°€ nullμ΄ μ•„λ‹ λ•λ§ DisplayNameμ„ μ¶λ ¥ν•λ„λ΅ μ΅°κ±΄ μ¶”κ°€
    if (endPoint != null)
    {
        await context.Response.WriteAsync($"[Before Routing] Endpoint: {endPoint.DisplayName}\n");
    }

    // λ‹¤μ λ―Έλ“¤μ›¨μ–΄λ΅ μ”μ²­μ„ μ „λ‹¬ν•λ‹¤.
    await next(context);
});

// --- 2. λΌμ°ν… λ―Έλ“¤μ›¨μ–΄ ν™μ„±ν™” ---
// μ΄ λ©”μ„λ“κ°€ μ‹¤ν–‰λλ©΄μ„ λ“¤μ–΄μ¨ μ”μ²­μ— λ§λ” μ—”λ“ν¬μΈνΈλ¥Ό 'μ„ νƒ'ν•λ‹¤.
app.UseRouting();

// --- 3. 'UseRouting' νΈμ¶ ν›„ λ―Έλ“¤μ›¨μ–΄ ---
// μ΄μ  μ—”λ“ν¬μΈνΈκ°€ μ„ νƒλμ—μΌλ―€λ΅ μ •λ³΄λ¥Ό ν™•μΈν•  μ μλ‹¤.
app.Use(async (context, next) =>
{
    // UseRouting()μ΄ μ‹¤ν–‰λ ν›„μ΄λ―€λ΅, μΌμΉν•λ” μ—”λ“ν¬μΈνΈ κ°μ²΄λ¥Ό κ°€μ Έμ¬ μ μλ‹¤.
    Microsoft.AspNetCore.Http.Endpoint? endPoint = context.GetEndpoint();

    if (endPoint != null)
    {
        // μ—”λ“ν¬μΈνΈμ DisplayNameκ³Ό κ°™μ€ μƒμ„Έ μ •λ³΄λ¥Ό μ‘λ‹µμ— μ¶λ ¥ν•λ‹¤.
        await context.Response.WriteAsync($"[After Routing] Endpoint: {endPoint.DisplayName}\n");
    }

    await next(context);
});

// --- 4. μ—”λ“ν¬μΈνΈ μ‹¤ν–‰ λ―Έλ“¤μ›¨μ–΄ ---
// 'μ„ νƒλ' μ—”λ“ν¬μΈνΈλ¥Ό 'μ‹¤ν–‰'ν•λ‹¤.
app.UseEndpoints(endpoints =>
{
    // GET /map1 μ”μ²­μ— λ€ν• μ—”λ“ν¬μΈνΈλ¥Ό μ •μν•λ‹¤.
    endpoints.MapGet("map1", async (context) => {
        await context.Response.WriteAsync("Response from Map 1\n");
    });

    // POST /map2 μ”μ²­μ— λ€ν• μ—”λ“ν¬μΈνΈλ¥Ό μ •μν•λ‹¤.
    endpoints.MapPost("map2", async (context) => {
        await context.Response.WriteAsync("Response from Map 2\n");
    });
});

// μΌμΉν•λ” μ—”λ“ν¬μΈνΈκ°€ μ—†μ„ κ²½μ° μ‹¤ν–‰λ  ν΄λ°±(Fallback) λ―Έλ“¤μ›¨μ–΄
app.Run(async context => {
    await context.Response.WriteAsync($"No endpoint found for {context.Request.Path}\n");
});

app.Run();
```

---

### β¨ μ‹¤ν–‰ νλ¦„ λ¶„μ„

#### π¤” `UseRouting`μ€ ν•λ²λ§ μ‹¤ν–‰λλ”κ±° μ•„λ‹κ°€??

μ΄ μ½”λ“λ¥Ό λ³΄λ©΄ "μ„λ²„κ°€ μΌμ§ λ• `UseRouting`μ΄ μ΄λ―Έ μ‹¤ν–‰λμ„ ν…λ°, μ™ μ²« λ²μ§Έ λ―Έλ“¤μ›¨μ–΄μ—μ„ μ—”λ“ν¬μΈνΈλ¥Ό λ» μ°Ύλ” κ±°μ§€?" λΌλ” μƒκ°μ΄ λ“¤μ—λ”λ°. μ΄λ” **μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘**κ³Ό **κ°λ³„ μ”μ²­ μ²λ¦¬**λ¥Ό κµ¬λ¶„ν•΄μ•Ό μ΄ν•΄ν•  μ μλ‹¤.

- π­ 1. μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ (νμ΄ν”„λΌμΈ κµ¬μ„±)
  app.Run()μ΄ νΈμ¶λκΈ° μ „κΉμ§€μ μ½”λ“λ” μ‹¤μ  μ”μ²­μ„ μ²λ¦¬ν•λ” κ² μ•„λ‹λΌ, μ”μ²­ μ²λ¦¬ νμ΄ν”„λΌμΈμ΄λΌλ” μ»¨λ² μ΄μ–΄ λ²¨νΈλ¥Ό μ„¤κ³„ν•κ³  μ΅°λ¦½ν•λ” κ³Όμ •μ΄λ‹¤. app.UseRouting() κ°™μ€ μ½”λ“λ” "μ—¬κΈ°μ— λΌμ°ν… λ¶€ν’μ„ λ†“κ² λ‹¤"κ³  μ„ μ–Έν•λ” κ²ƒκ³Ό κ°™λ‹¤. app.Run()μ€ μ΄ μ»¨λ² μ΄μ–΄ λ²¨νΈλ¥Ό κ°€λ™μ‹ν‚¤λ” μ¤μ„μΉλ‹¤.
    
- π— 2. HTTP μ”μ²­ μ²λ¦¬ (νμ΄ν”„λΌμΈ μ‹¤ν–‰)
  μ‚¬μ©μκ°€ /map1 κ°™μ€ URLμ„ νΈμ¶ν•λ©΄, μ΄ μ”μ²­μ€ μƒλ΅μ΄ μƒμμ²λΌ μ°λ¦¬κ°€ μ΅°λ¦½ν• μ»¨λ² μ΄μ–΄ λ²¨νΈμ λ§¨ μ²μλ¶€ν„° μ—¬ν–‰μ„ μ‹μ‘ν•λ‹¤. λ¨λ“  μ”μ²­μ€ μ΄ λ²¨νΈλ¥Ό μ²μλ¶€ν„° λκΉμ§€ ν†µκ³Όν•λ©° κ° λ¶€ν’(λ―Έλ“¤μ›¨μ–΄)μ„ μμ„λ€λ΅ κ±°μΉλ‹¤. μ΄μ „ μ”μ²­μ΄ μ–΄λ””κΉμ§€ κ°”λ”μ§€λ” λ‹¤μ μ”μ²­κ³Ό μ•„λ¬΄ μƒκ΄€μ΄ μ—†λ‹¤.
    

#### π—ΊοΈ `/map1` μ”μ²­μ μ‹¤μ  μ—¬ν–‰ κ²½λ΅

μ„ κ°λ…μ„ λ°”νƒ•μΌλ΅ `/map1` GET μ”μ²­μ νλ¦„μ„ λ‹¤μ‹ λ”°λΌκ°€ λ³΄μ.

1. **μ”μ²­ μ‹μ‘**: μ”μ²­μ΄ μ»¨λ² μ΄μ–΄ λ²¨νΈμ μ‹μ‘μ μ— λ†“μΈλ‹¤.
2. **μ²« λ²μ§Έ λ―Έλ“¤μ›¨μ–΄ ν†µκ³Ό**: μ΄ μ‹μ μ—μ„ μƒμ(`HttpContext`)λ” λΉ„μ–΄μλ‹¤. λΌμ°ν… λ¶€ν’(`UseRouting`)μ„ μ•„μ§ μ• κ±°μ³¤μΌλ―€λ΅ `context.GetEndpoint()`λ” λ‹Ήμ—°ν `null`μ΄λ‹¤.
3. **`app.UseRouting()` ν†µκ³Ό**: λΌμ°ν… λ¶€ν’μ΄ μƒμλ¥Ό μ—΄κ³ , μ”μ²­μ΄ `/map1`μΈ κ²ƒμ„ ν™•μΈν• λ’¤ 'map1 μ—”λ“ν¬μΈνΈ'λΌλ” μ¤ν‹°μ»¤λ¥Ό λ¶™μΈλ‹¤.
4. **λ‘ λ²μ§Έ λ―Έλ“¤μ›¨μ–΄ ν†µκ³Ό**: μ΄μ  μƒμμ— 'map1 μ—”λ“ν¬μΈνΈ' μ¤ν‹°μ»¤κ°€ λ¶™μ–΄μμΌλ―€λ΅, `context.GetEndpoint()`λ” ν•΄λ‹Ή μ—”λ“ν¬μΈνΈ μ •λ³΄λ¥Ό μ„±κ³µμ μΌλ΅ λ°ν™ν•λ‹¤.
5. **`app.UseEndpoints()` ν†µκ³Ό**: 'map1 μ—”λ“ν¬μΈνΈ' μ¤ν‹°μ»¤λ¥Ό ν™•μΈν•κ³ , κ·Έμ— λ§λ” μ‹¤μ  μ‘μ—…(`Response from Map 1` μ¶λ ¥)μ„ μν–‰ν•λ‹¤.

μµμΆ…μ μΌλ΅ λΈλΌμ°μ €μ—λ” μ•„λμ™€ κ°™μ€ κ²°κ³Όκ°€ λ‚νƒ€λ‚λ‹¤.

```
[After Routing] Endpoint: HTTP: GET /map1
Response from Map 1
```

---

### β… μ‹¤μ©μ μΈ μ‚¬μ© μ‚¬λ΅€

μ—”λ“ν¬μΈνΈκ°€ μ‹¤ν–‰λκΈ° _μ „μ—_ μ–΄λ–¤ μ—”λ“ν¬μΈνΈκ°€ μ„ νƒλμ—λ”μ§€ μ•„λ” κ²ƒμ€ λ§¤μ° μ μ©ν•λ‹¤. μλ¥Ό λ“¤μ–΄ λ‹¤μκ³Ό κ°™μ€ μ‹λ‚λ¦¬μ¤μ—μ„ ν™μ©ν•  μ μλ‹¤.

- **λ™μ  λ΅κΉ…(Dynamic Logging)**: νΉμ • μ—”λ“ν¬μΈνΈ κ·Έλ£Ή(μ: `/api/`λ΅ μ‹μ‘ν•λ” λ¨λ“  μ—”λ“ν¬μΈνΈ)μ— λ€ν•΄μ„λ§ μƒμ„Έν• μ”μ²­/μ‘λ‹µ λ΅κ·Έλ¥Ό λ‚¨κΈ°κ³  μ‹¶μ„ λ•, `UseRouting`κ³Ό `UseEndpoints` μ‚¬μ΄μ λ―Έλ“¤μ›¨μ–΄μ—μ„ μ—”λ“ν¬μΈνΈ μ •λ³΄λ¥Ό ν™•μΈν•κ³  μ΅°κ±΄λ¶€λ΅ λ΅κΉ…μ„ μν–‰ν•  μ μλ‹¤.
- **μ»¤μ¤ν…€ κ¶ν• λ¶€μ—¬(Custom Authorization)**: νΉμ • μ—”λ“ν¬μΈνΈμ— λ€ν• μ ‘κ·Όμ„ λ™μ μΌλ΅ μ μ–΄ν•΄μ•Ό ν•  λ•, μ„ νƒλ μ—”λ“ν¬μΈνΈμ λ©”νƒ€λ°μ΄ν„°(Metadata)λ¥Ό μ½μ–΄μ™€ μ¶”κ°€μ μΈ κ¶ν• κ²€μ‚¬λ¥Ό μν–‰ν•  μ μλ‹¤.
    

---

### μ”μ•½

- `app.UseRouting()`μ€ μ”μ²­μ— λ§λ” μ—”λ“ν¬μΈνΈλ¥Ό **μ„ νƒ**ν•λ‹¤.
- `app.UseEndpoints()`μ€ μ„ νƒλ μ—”λ“ν¬μΈνΈλ¥Ό **μ‹¤ν–‰**ν•λ‹¤.
- λ―Έλ“¤μ›¨μ–΄ νμ΄ν”„λΌμΈμ€ μ„λ²„ μ‹μ‘ μ‹ **ν• λ²λ§ κµ¬μ„±**λκ³ , λ¨λ“  HTTP μ”μ²­μ€ μ΄ νμ΄ν”„λΌμΈμ„ **λ§¤λ² μ²μλ¶€ν„° λκΉμ§€** ν†µκ³Όν•λ‹¤.
- μ΄ λ•λ¬Έμ— `UseRouting`λ³΄λ‹¤ μ•μ— μλ” λ―Έλ“¤μ›¨μ–΄λ” ν•΄λ‹Ή μ”μ²­μ— λ€ν• μ—”λ“ν¬μΈνΈ μ •λ³΄λ¥Ό μ• μ μ—†λ‹¤.